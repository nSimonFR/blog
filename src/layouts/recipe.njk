---
layout: base.njk
mainClass: recipe-page
pageCss: recipe
---

{% if images.main %}
  <div class="recipe-main-image">
    <img src="../{{ images.main }}" alt="{{ title }}" loading="lazy"></div>
  {% endif %}
  <h1>{{ title | title }}</h1>
  <div class="recipe-meta">
    {% if recipe and recipe.metadata %}
      {% set prepTime = recipe.metadata["time.prep"] %}
      {% set cookTime = recipe.metadata["time.cook"] %}
      {% if prepTime or cookTime %}
        <span class="recipe-time">
          {% if prepTime %}
            {{ prepTime }} min de préparation{% endif %}
          {% if prepTime and cookTime %}
            &
          {% endif %}
          {% if cookTime %}
            {{ cookTime }} min de cuisson{% endif %}
        </span>
      {% endif %}
    {% endif %}
    <div class="recipe-actions">
      {% set cookFilePath = page.inputPath | replace("./src/", "") | replace("src/", "") %}
      <a href="/{{ cookFilePath }}" download="{{ title | slugify }}.cook" class="download-button">
        Télécharger le .cook
      </a>
    </div>
  </div>
  <div class="tags">
    {% for tag in tags -%}
      {% set tagUrl %}/tags/{{ tag }}/{% endset %}
      <a href="{{ tagUrl | url }}">#{{ tag }}</a>
    {%- endfor %}
  </div>
  {% if subtitle %}
    <div class="recipe-subtitle">
      {{ subtitle }}
    </div>
  {% endif %}
  <div class="recipe-columns">
    <section class="recipe-ingredients">
      <h2>Ingrédients</h2>
      <ul>
        {% for item in ingredients %}
          {# Skip recipe references (ingredients that start with ./ or ../ and end with .cook) #}
          {% if not ((item.name.startsWith('./') or item.name.startsWith('../')) and item.name.endsWith('.cook')) %}
            <li>{{ item.quantity }}
              {{ item.units }}
              {{ item.name }}</li>
          {% endif %}
        {% endfor %}
      </ul>
    </section>
    <section class="recipe-cookware">
      <h2>Ustensiles</h2>
      <ul>
        {% for item in cookware %}
          <li>{{ item.name }}</li>
        {% endfor %}
      </ul>
    </section>
  </div>
  <section class="recipe-instructions">
    <h2>Étapes</h2>
    <ol>
      {% for step in steps %}
        <li class="recipe-step">
          <div class="recipe-step-content">
            {%- for item in step -%}
              {{ item | safe }}
            {%- endfor -%}
          </div>
          {% if images.steps[loop.index] %}
            <div class="recipe-step-image">
              <img src="../{{ images.steps[loop.index] }}" alt="Step {{ loop.index }}" loading="lazy"></div>
            {% endif %}
          </li>
        {% endfor %}
      </ol>
    </section>
